version: '1'

meta:
  name: Summarize E-mails
  description: Summarize an email and extract the most important information.
  author: Nanoworks

flows:
  nodes:
    INPUT_KEY:
      kind: core:input
      key: key
      type: core:string

    INPUT_EMAIL_CONTENT:
      kind: core:input
      key: emailContent
      type: core:string

    PROMPT:
      kind: core:template
      emailContent: 
        $fromVariable:
          name: INPUT_EMAIL_CONTENT
      template: |
        Summarize the email content.
        - Extract the most important information.
        - Keep the summary short and concise.
        - Avoid repeating the same information.
        
        Email Content: {{ emailContent }}

    MODEL: 
      kind: core:ollama-api
      model:
        $ref: 
          fromSecret: OLLAMA_MODEL
      endpoint:
        $ref: 
          fromSecret: OLLAMA_ENDPOINT
      token:
        $ref: 
          fromSecret: OLLAMA_TOKEN
    
    SUMMARIZE:
      kind: core:inference
      model: 
        $ref:
          fromNode: MODEL
      prompt: $NODE.PROMPT.value
      maxTokens: 100
      temperature: 0.5

    OUTPUT_SUMMARY:
      kind: core:output
      type: core:string
      value:
        $ref: 
          fromNode: SUMMARIZE
